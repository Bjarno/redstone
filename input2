/* @assumes [random():Num] */

/* @server */ 
{
  function broadcast(name, message) {
      displayMessage(name, message);
  }
}
    
/* @client */
  {
    var name = "user"  + random(),
        btn  = $("#btn"),
        text = $("#text");

    function chatHandler () {
       var msg = text.value();
       broadcast(name, msg);
    }
    btn.onClick(chatHandler);
    function displayMessage(name, message) {
        text.value(name + ":said " + message)
    }
}

/* @ui */
head
  title Chatting, made simple.
  style..
    body {
      background-color:green;
    }
  link[rel=stylesheet][type=text/css][href=style.css]
body
  div#log
  textarea#msg
  button[@click=sendmsg]#send Send
  p.
    This is a text, if an element ends with a . followed by
    a newline. Everything below is parsed as text in this tag.
    It is possible to escape from this by identing another level.
      span Like this.
    When the original indent is being used, the prior behaviour
    is restored. This makes it possible to make some tags
      b bold
    or
      i italic
    .
    A . at the start of text is also allowed, and has no special
    meaning.
  img funny.gif
  p.
    Last message: {{lastmessage}}