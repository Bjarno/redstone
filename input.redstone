/* @server */ 
{
  function broadcast(name, message) {
      console.log(name + " said: " + message);
      displayMessage(name, message);
  }
}

/* @client */
{
    // Doesn't work:
    // var last = {message: "no-message", author: "no-author"};

    // Does work
    var last;
    last = {};
    last.message = "no-message";
    last.author = "no-author";

    function randomInt(min, max) {
    	return Math.floor(Math.random() * (max - min + 1)) + min;
	}
	
	var name = "user" + randomInt(100, 10000),
        text = $("#msg"),
        log  = $("#log");

    function sendmsg() {
       var msg = text.val();
       broadcast(name, msg);
       text.val("");
    }

    function displayMessage(name, message) {
        log.append(name + " said: " + message + "<br>");
        last.message = message; // Must be on client (?)
        last.author  = name;
    }
}

/* @ui */
head
	title Chatting, made simple.
	style..
		body {
			background-color: #ccc;
			font-family: sans-serif;
		}
		textarea, #log {
			display: block;
			font-family: monospace;
			width: 85%;
		}
		#log {
			height: 100px;
			overflow: auto;
			background-color: white;
		}
	link[rel=stylesheet][type=text/css][href=style.css]
body
	div#log
	textarea#msg
	button[@click=sendmsg]#send Send
	{{#if hassmiley}}
		p I have a smiley face!
	p.
		Last message: {{last.message}} by {{last.author}}.	}
